<script>
// ... keep everything else the same above ...

// app controls
document.getElementById('btnClose').addEventListener('click',()=>{
  // close the tab entirely
  window.close();
});

document.getElementById('btnMin').addEventListener('click',()=>{
  app.style.display='none';
});

document.getElementById('btnMax').addEventListener('click',()=>{
  // use Fullscreen API
  if (!document.fullscreenElement) {
    app.requestFullscreen().catch(err=>{
      console.warn("Fullscreen request failed:", err);
    });
  } else {
    document.exitFullscreen();
  }
});

// drag app by titlebar
(function attachAppDrag(){
  const title = document.getElementById('appTitlebar');
  let dragging=false, sx,sy,ox,oy;
  title.addEventListener('pointerdown',(e)=>{
    if(document.fullscreenElement) return; // donâ€™t drag in fullscreen
    dragging=true; title.setPointerCapture(e.pointerId);
    sx=e.clientX; sy=e.clientY;
    const r=app.getBoundingClientRect();
    ox=r.left; oy=r.top;
  });
  window.addEventListener('pointermove',(e)=>{
    if(!dragging) return;
    app.style.left = (ox + e.clientX - sx) + 'px';
    app.style.top  = (oy + e.clientY - sy) + 'px';
  });
  window.addEventListener('pointerup',(e)=>{ dragging=false; try{ title.releasePointerCapture(e.pointerId) }catch(e){} });
})();

// ... keep rest unchanged ...
</script>
